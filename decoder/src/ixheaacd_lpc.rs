// decoder::ixheaacd::lpc (Linear Predictive Coding)
//
// The file contains functions for:
//
//  1. LSF/LSP conversions - Line Spectral Frequencies/Pairs (stable LPC representation)
//  2. LPC coefficient interpolation - smooth transitions between frames
//  3. ACELP decoding - Code-Excited Linear Prediction
//  4. Bass Post-Filter - uses pitch periodicity (related to LPC residual)


// =============================================================================
// Constants from ixheaacd_cnst.h
// =============================================================================

/// Superframe length in samples
pub const LEN_SUPERFRAME: usize = 1024;

/// Single frame length
pub const LEN_FRAME: usize = 256;

/// Number of frames per superframe
pub const NUM_FRAMES: usize = 4;

/// LPC order (number of coefficients)
pub const ORDER: usize = 16;

/// Subframe length in samples
pub const LEN_SUBFR: usize = 64;

/// Total subframes per superframe
pub const NUM_SUBFR_SUPERFRAME: usize = 16;

/// Half of total subframes
pub const NUM_SUBFR_SUPERFRAME_BY2: usize = NUM_SUBFR_SUPERFRAME / 2;

/// Maximum synthesis delay
pub const SYNTH_DELAY_LMAX: usize = (NUM_SUBFR_SUPERFRAME_BY2 - 1) * LEN_SUBFR;

/// Maximum pitch lag
pub const MAX_PITCH: usize = 289; // Calculated from TMAX formula

/// Filter delay for BPF
pub const FILTER_DELAY: usize = 12;

// =============================================================================
// LPD Bass Post-Filter
// =============================================================================

/// Error type for LPC operations
#[derive(Debug, Clone, Copy, PartialEq, Eq)]
pub enum LpcError {
    /// Invalid pitch lag or buffer index
    InvalidPitchLag,
    /// Null pointer passed to function
    NullPointer,
    /// Buffer overflow detected
    BufferOverflow,
}

/// Result type for LPC operations
pub type LpcResult<T> = Result<T, LpcError>;

/// Applies Bass Post-Filter to synthesized audio during LPD-to-FD transition.
///
/// The Bass Post-Filter (BPF) reduces inter-harmonic noise in voiced speech
/// by exploiting pitch periodicity. This function is called when transitioning
/// from LPD (Linear Prediction Domain) coding back to frequency domain.
///
pub fn lpd_bpf_fix(
    usac_data: &crate::gen_ixheaacd_ref::ia_usac_data_struct, // The main USAC decoder state
    is_short_flag: bool, // True if previous frame used short windows
    out_buffer: &mut [f32], // Audio sample buffer (input/output)
    st: &crate::gen_ixheaacd_ref::ia_usac_lpd_decoder, // LPD decoder state
) -> LpcResult<()> 
{
    #[cfg(feature = "fallback")]
    #[allow(invalid_reference_casting)]
    let result = unsafe {
        crate::gen_ixheaacd_ref::ixheaacd_lpd_bpf_fix(
            usac_data as *const crate::gen_ixheaacd_ref::ia_usac_data_struct as *mut crate::gen_ixheaacd_ref::ia_usac_data_struct,
            if is_short_flag { 1 } else { 0 },
            out_buffer.as_mut_ptr(),
            st as *const crate::gen_ixheaacd_ref::ia_usac_lpd_decoder as crate::gen_ixheaacd_ref::ia_usac_lpd_decoder_handle,
        )
    };

    if result == 0 {
        Ok(())
    } else {
        Err(LpcError::InvalidPitchLag)
    }
}


// =============================================================================
// Unit Tests
// =============================================================================

#[cfg(test)]
mod tests {
    use super::*;
    use approx::assert_relative_eq;

    #[test]
    fn test_constants() {
        assert_eq!(LEN_SUPERFRAME, 1024);
        assert_eq!(LEN_SUBFR, 64);
        assert_eq!(NUM_SUBFR_SUPERFRAME, 16);
        assert_eq!(NUM_SUBFR_SUPERFRAME_BY2, 8);
        assert_eq!(SYNTH_DELAY_LMAX, 448); // (8-1) * 64
        assert_eq!(ORDER, 16);
    }

    fn create_test_usac_data() -> Box<crate::gen_ixheaacd_ref::ia_usac_data_struct> {
        unsafe { 
            let mut big = Box::<crate::gen_ixheaacd_ref::ia_usac_data_struct>::new_uninit(); //zeroed();
            let data = big.as_mut_ptr();
            (*data).ccfl = 1024;
            (*data).num_subfrm = 4;
            (*data).ec_flag = 0;
            big.assume_init()
        }
    }

    fn create_test_lpd_data() -> Box<crate::gen_ixheaacd_ref::ia_usac_lpd_decoder> {
        Box::new(crate::gen_ixheaacd_ref::ia_usac_lpd_decoder {
            mode_prev: 1,
            synth_prev: [ -1215.695923, -949.382812, 459.589417, -684.690796, -116.072693, 2.434937, -941.744873, -243.565582, 506.583527, -30.801025, -326.355835, 228.357056, -596.459961, 6.780762, -438.887909, -557.831482, -280.184784, 51.546875, 20.640705, 140.553345, -33.624054, -603.301941, -1401.964355, -1121.838379, -452.640015, -651.783264, -544.078979, -746.528076, 175.880127, 531.428101, -452.758728, 521.039673, 1116.736816, 457.173340, 597.704590, 259.673798, 1303.793579, 965.068176, 802.291443, 670.183228, 732.240051, 1014.266113, 887.583618, 1223.403198, 639.387512, 115.114746, 404.511414, 722.929321, 1158.420288, 563.616211, 961.318787, 1050.339844, 1067.582275, 128.264175, 729.445679, 693.757141, 1529.424927, 1769.868164, 1711.830811, 1016.099365, 970.975159, 1346.435425, 1466.140503, 1031.324829, 1758.299805, 1110.082031, 957.477600, 756.570312, 40.520813, 872.351685, 1118.623291, 62.914185, 358.361176, 491.237091, -1485.195557, -1071.925171, 804.202576, -308.271027, -1042.185059, -95.703278, 420.871887, -1630.915527, -1329.058105, -511.801880, -970.133667, -1041.457642, 260.194397, 117.017090, -372.194916, 90.672279, 367.956024, -431.358032, -242.683441, 231.493118, -1231.103149, -257.648865, -3.757156, -295.445984, -1045.241455, -710.597839, -1131.274292, -331.522949, -509.897919, -663.725769, 114.008636, -657.499329, -755.269287, -113.133270, -245.747650, -417.146667, -181.902069, -388.793213, -935.063293, -458.976074, -113.953110, -291.587463, -511.889709, -492.793518, -354.386963, -1023.760010, -506.703857, -127.395279, -455.024658, -636.552856, -499.152710, 383.439972, -153.758606, -605.898621, -138.961151, 725.007812, -96.385559, -141.931824, 94.061005, 82.543320, 767.098816, 1099.250488, 226.586548, 856.585205, 401.822327, 1204.677490, 1143.999878, 392.405762, 590.660156, 831.223267, 1470.015625, 1793.397827, 587.983459, 531.390442, 1056.821533, 983.975220, 1219.333740, 833.365356, 569.764893, 714.429749, 761.674561, 274.502930, 295.263428, 736.793152, 761.933350, 507.920807, 669.881470, 564.089661, -1003.057983, 530.320007, -553.387756, 15.005524, -704.533813, -1816.607056, -1282.390137, 365.940857, -865.240906, -2486.559082, -967.712463, -746.793518, -975.611633, -1658.127441, -1476.287598, -1211.036011, -1150.768066, -1547.042236, -1143.666138, -949.654419, -1239.536255, -1405.797729, -1530.512085, -777.679810, -235.795624, -654.401428, -1490.381348, -1902.043701, -832.712646, -60.930328, -475.631165, 168.555908, -100.469658, -888.875732, 56.425415, 437.638184, 203.561829, 477.524048, -950.923401, 1122.673950, 213.370728, 712.430847, 1243.161987, -725.477356, 434.906097, 2156.896729, -30.698486, 658.670105, 1311.771484, 638.587646, 1123.703247, 1766.056885, 1163.329102, 2031.551758, 417.231567, 214.089767, 2039.120605, 1486.194092, 1011.235596, 1921.950439, 1578.636108, 936.750244, 574.692261, 272.625916, 1476.804688, 1305.291870, 969.008362, 835.955322, 336.921936, 2533.789062, 1016.913757, 794.663879, 1375.458740, 16.180725, 1398.375000, 1553.655640, 1080.016113, 79.887085, 508.173370, 904.818970, 1090.343750, 1048.784668, 972.913940, 554.086426, 375.178192, 636.058472, 840.419434, 717.048462, 382.545258, 464.904785, 438.130981, 385.830750, 146.844360, 211.546234, 464.304779, -482.281342, -688.373657, 605.926758, 122.532410, -806.181396, -608.530640, -808.871582, -604.406982, 25.500153, -1590.403931, -1290.269409, -1390.759766, -941.085449, -1175.262451, -1111.510742, -2000.242432, -1223.243164, -285.325928, -1453.547363, -1353.051392, -1142.304688, -2179.771973, -1016.821533, 384.618225, -1078.490479, -1421.533325, -278.507935, -914.027100, -664.612305, -820.889404, -632.345886, -41.733612, -692.774231, -897.681091, -305.139771, -989.794617, -801.156372, -988.495483, -762.411987, -1707.393311, -415.752014, -263.606903, 606.379150, -172.386780, 206.531494, -496.737305, -345.749023, 1320.770874, 355.143799, 993.351318, 2.109131, 414.974670, 1884.510254, 1058.720093, 431.466339, 276.744873, 1075.808105, 1449.721191, 796.286682, 786.772827, 1172.086914, 871.587341, 957.026367, 1193.727661, 1118.125000, 1041.473022, 270.029846, 351.445190, 1113.085693, 1148.339600, 4.110779, 49.851021, 933.728027, 1546.072754, -63.956421, -400.990784, 500.953522, -212.785065, -263.319122, 465.348572, 641.919861, 773.718872, -73.538635, 1.536957, 242.236908, 78.606522, 501.793732, 563.931519, -970.023132, -114.028931, 467.933411, 301.235596, 2400.651855, -186.349365, -744.565613, 449.813660, 1042.555908, 1043.972534, 294.771362, 152.571716, -1026.412109, 1638.286621, -201.840332, 2349.887939, 2561.474121, 1215.751343, -1301.976807, 387.120605, 1645.375244, 1673.705566, 1148.241943, 883.801147, 3199.902588, 624.155151, 317.001892, 1191.114380, 1220.561279, 1268.765015, 890.734009, 616.344543, 1034.655396, 957.351196, 118.772156, 222.747009, 576.872925, 907.949951, 715.430603, -1292.996338, 41.250061, -246.897888, 1282.050537, -990.700745, -1415.967773, -1111.698975, -1773.731445, -1014.710022, -308.274750, 548.846069, -2584.419678, -1866.808716, -862.505005, 893.189819, -1147.078857, -3641.549072, -955.407471, -315.654968, -2540.219238, -951.907410, -624.865356, -1149.685791, -1485.685791, -3787.747803, -397.000244, -1004.133301, -1810.969604, -1090.712524, -1548.745850, -1001.946472, -568.383423, -1399.319824, -2405.695557, 1086.779541, -130.638062, -859.159424, -1215.996948, -280.416626, 842.752747, -3473.235352, -2045.372070, 1166.631348, 1760.208008, -684.963867, 623.243774, -558.873169, 170.787170, 207.868134, -311.757324, 598.813171, 514.057007, 439.332611, 695.068359, 587.617371, 443.902527, 320.533264, -380.215302, 304.143524, 788.383423, 712.875854, 301.409241, 1877.411377, 890.904846, 227.126740, 2300.040039, 2374.588379, 279.406006, 689.846802, 1382.471436, 1532.023682, 2757.374512, -897.838379, 768.069641, 1618.520752, 1223.336060, -256.779541, 589.315979, -793.218872, -807.392212, 721.920898, 270.126587, 34.240768, -486.923370, -533.067078, -342.240204, -354.690186, 1386.545410, -174.670349, -1391.195801, -569.116089, -1639.018188, -1170.617676, 1811.890625, -1092.736816, -1980.841187, -3181.816406, -2597.465332, 608.678101, -148.611389, -3829.051514, -1985.830566, -2873.900635, 1247.149902, -919.977600, -1863.439697, -1741.630371, -320.995361, -1799.823608, -964.421570, -447.284149, -584.864258, -1312.809570, -2208.395020, 970.004272, -732.038696, -1187.905151, -727.119446, -770.636597, -450.867371, -21.085480, -869.005676, 903.008240, 9.611511, -300.709717, 98.946259, -289.705933, 547.383911, 179.550919, -1476.509399, 933.601257, 2243.376221, 2055.602783, 194.664917, 305.672180, 1250.905640, 1230.914917, 958.201294, 856.792664, 848.031372, 984.095093, 1097.850464, 1023.727539, 1092.034546, 770.225647, 485.073395, 342.561401, 676.237549, 989.292419, 747.432434, 545.737000, 1033.376709, 838.720703, 2434.796875, 1349.403076, 785.106201, 290.787354, 1580.901855, 2811.789551, 1068.605225, 572.947205, 1562.107666, -1484.643921, -422.251831, 1861.705200, 2126.255859, -136.089722, -966.816589, -19.859131, 164.761597, 76.350189, 484.062286, -418.952637, -712.246582, 102.882233, 65.237984, -75.846420, 1455.896606, 128.788574, -2186.134277, -175.934326, 533.289307, -417.827698, -1837.183228, 1259.949219, -1707.127808, -1557.582764, 543.913696, -1024.120117, -999.620300, -688.802368, -1402.526978, -984.533203, -577.601013, 1.597687, -448.548157, -2779.151367, -132.440796, 127.576393, -1159.496216, -591.234009, -761.699890, -868.097534, -553.323059, -598.193298, 1347.606934, -808.657288, -1132.797607, -1269.541016, -176.116272, -870.298096, -129.552155, -414.059875, -329.885681, -438.559937, -186.894547, -193.513184, -369.270691, -156.892181, 721.116394, -1016.575867, -337.550262, 409.850281, -360.587341, -712.011780, 408.418884, 286.642395, 900.344727, 1073.104248, 386.026062, 590.411804, 286.409180, 1685.595947, 929.072754, -240.138138, -1264.521606, 261.584839, 2514.025879, 1019.530457, -1789.124268, -705.084961, 895.520386, 1180.100098, 771.645020, 768.838623, 34.703827, 1001.947510, 2293.021973, -65.707275, -677.086792, 885.464844, 933.176392, 906.770020, 415.982178, -350.376587, 529.009644, 888.999207, -13.577972, -988.032349, 963.293884, 1456.130615, -959.203735, 584.057251, 1314.450073, -341.442902, -459.267578, 966.422241, -636.717346, -1193.484375, -126.362244, -1169.683716, -1757.143799, -1406.462646, -1309.041260, -1618.589111, -957.509888, -2497.054199, -2753.322510, -1359.652344, 431.389160, -1609.683960, -1824.436279, -869.819092, -1070.816162, -1987.131836, -2131.802246, -859.036865, -1373.548340, -1404.140381, -995.434692, -1320.533081, -1741.448608, -1381.586426, -1475.017822, -1435.972412, -1131.999023, -2033.722412, -722.850098, 1187.500488, -652.579529, -1970.623535, 115.820923, -111.190186, 214.521973, 1320.788940, -58.478027, -1616.345215, 1235.146973, 2039.784424, -169.334595, 918.201843, 665.967773, -1015.785889, 409.208618, 2186.908691, 1123.539307, 3049.583008, 1353.110107, -197.554810, 1795.498047, 1533.340698, 1401.702637, 2039.110840, 829.991699, 493.812744, 1456.693359, 2315.444824, 1748.297852, -249.239594, 1092.689087, 1456.991455, 536.435303, -378.882202, -22.326416, 1053.807007, 2721.808350, 901.452271, -50.761536, 598.957092, 1674.548950, 1764.037720, -159.007812, -977.642578, 443.806702, 474.254395, -725.266113, 577.144592, 1115.537109, 462.572540, 456.319305, -153.502655, 506.564117, 334.575531, 123.100555, 1455.736206, 1164.701050, -269.195984, 293.358582, 321.179810, 417.977081, 548.043884, -89.463280, 435.077820, -790.493652, -1268.832520, 944.261841, 976.044373, -838.049561, -835.458557, -1753.955078, 155.302582, -100.655876, -747.651245, -1599.042114, -229.355606, -1533.084961, -2068.353271, -1753.591797, -791.273865, -1607.679199, -3754.753906, -2600.237549, -1102.566528, -2637.984375, -2180.774414, -1166.620605, -1566.946777, -1515.402222, -1647.961060, -1109.382446, -1266.180420, -1497.398315, -429.414276, -467.172119, -1514.065796, -1295.601196, -914.081238, 129.538956, -550.361267, -1031.981812, -212.233337, 534.195923, -1190.139771, -1930.285522, 491.477448, 964.432922, 61.812962, -254.304398, 8.147289, 757.310547, 1150.953857, 1119.353394, -559.292847, 1138.044312, 1746.908936, 1479.073120, 1050.278320, 1087.176636, 686.304138, 1496.199219, 1219.088623, 882.668030, 1341.571045, 1033.487061, 1321.066284, 1207.521973, 2042.314331, 338.323761, 1189.198364, 1736.923462, 878.203918, 591.281067, 1742.342285, 1158.396484, -265.886353, 457.979065, 840.524109, 967.415344, 310.001556, -103.161720, 756.025391, 320.861450, 50.193401, 1122.909058, 361.951660, 797.548645, 917.228943, -21.910641, 421.770660, 794.655823, 22.346663, -97.315163, 133.552094, -503.490417, -768.643372, -336.687134, 518.240723, 219.142563, -1523.513184, -1030.668335, -704.172302, -269.871918, -181.631287, -513.258850, -1176.015137, -976.112366, -1309.608521, -318.988892, -210.522736, -1657.461914, -999.470398, 573.408875, -746.667847, -544.474487, -605.486877],
            pitch_prev: [216, 89, 91, 91, 91, 64, 64],
            gain_prev: [0.691216, 0.564397, 0.445842, 0.445842, 0.445842, 0.000000, 0.000000],
            bpf_prev: [-216.101639, -83.285866, 28.101524, -154.622009, -365.182587, -202.017944, -134.252197, -259.233063, -332.520264, -84.673523, -445.450531, -202.969086, 257.126495, 531.436035, 1354.370972, 117.465561, 129.823593, 505.780426, 484.426270, 545.683228, 295.005676, 747.558472, -500.731659, 595.474487, -85.858734, 1266.105835, 1257.015747, 724.444458, -813.827026, 57.108658, 387.684448, 891.352051, 649.514526, 391.781921, 1195.630859, 382.656250, 58.041374, 434.866760, 446.758240, 439.189056, 283.749298, 214.109344, 431.037964, 327.480011, -189.518753, 291.701599, 188.625732, 161.029068, 320.881958, -635.965576, -222.502106, 55.654953, 283.359070, -625.279480, -808.241821, -527.318970, -504.316254, -608.156494, -477.890778, 550.767822, -354.439667, -756.872437, -873.060608, 435.615173, 288.273499, -1275.431396, -398.824829, -165.160492, -1076.260254, -382.246826, -83.695030, -515.445679, -964.648926, -1494.819092, 165.191528, -664.483948],
            ..unsafe { std::mem::zeroed() }
        })
    }

    #[test]
    fn test_lpd_bpf_fix_branch1() {
        let usac_data = create_test_usac_data();
        let lpd_st = create_test_lpd_data();

         let mut buffer = vec![467.933411f32, 301.235596, 2400.651855, -186.349365, -744.565613, 449.813660, 1042.555908, 1043.972534, 294.771362, 152.571716, -1026.412109, 1638.286621, -201.840332, 2349.887939, 2561.474121, 1215.751343, -1301.976807, 387.120605, 1645.375244, 1673.705566, 1148.241943, 883.801147, 3199.902588, 624.155151, 317.001892, 1191.114380, 1220.561279, 1268.765015, 890.734009, 616.344543, 1034.655396, 957.351196, 118.772156, 222.747009, 576.872925, 907.949951, 715.430603, -1292.996338, 41.250061, -246.897888, 1282.050537, -990.700745, -1415.967773, -1111.698975, -1773.731445, -1014.710022, -308.274719, 548.846069, -2584.419678, -1866.808716, -862.505005, 893.189819, -1147.078857, -3641.549072, -955.407471, -315.654968, -2540.219238, -951.907410, -624.865356, -1149.685791, -1485.685791, -3787.747803, -397.000244, -1004.133301, -1810.969604, -1090.712524, -1548.745850, -1001.946472, -568.383423, -1399.319824, -2405.695557, 1086.779541, -130.638062, -859.159424, -1215.996948, -280.416626, 842.752747, -3473.235352, -2045.372070, 1166.631348, 1760.208008, -684.963867, 623.243774, -558.873169, 170.787170, 207.868103, -311.757324, 598.813171, 514.057007, 439.332581, 695.068359, 587.617371, 443.902527, 320.533264, -380.215271, 304.143494, 788.383423, 712.875854, 301.409241, 1877.411377, 890.904846, 227.126709, 2300.040039, 2374.588379, 279.406006, 689.846802, 1382.471436, 1532.023682, 2757.374512, -897.838379, 768.069641, 1618.520752, 1223.336060, -256.779541, 589.315979, -793.218872, -807.392212, 721.920898, 270.126587, 34.240723, -486.923340, -533.067078, -342.240173, -354.690186, 1386.545410, -174.670349, -1391.195801, -569.116089, -1639.018188, -1170.617676, 1811.890625, -1092.736816, -1980.841187, -3181.816406, -2597.465332, 608.678101, -148.611389, -3829.051514, -1985.830566, -2873.900635, 1247.149902, -919.977600, -1863.439697, -1741.630371, -320.995361, -1799.823608, -964.421570, -447.284119, -584.864258, -1312.809570, -2208.395020, 970.004272, -732.038696, -1187.905151, -727.119446, -770.636597, -450.867371, -21.085449, -869.005676, 903.008240, 9.611511, -300.709717, 98.946228, -289.705933, 547.383911, 179.550903, -1476.509399, 933.601257, 2243.376221, 2055.602783, 194.664917, 305.672180, 1250.905640, 1230.914917, 958.201294, 856.792664, 848.031372, 984.095093, 1097.850464, 1023.727539, 1092.034546, 770.225647, 485.073364, 342.561401, 676.237549, 989.292419, 747.432434, 545.737000, 1033.376709, 838.720703, 2434.796875, 1349.403076, 785.106201, 290.787354, 1580.901855, 2811.789551, 1068.605225, 572.947205, 1562.107666, -1484.643921, -422.251831, 1861.705200, 2126.255859, -136.089722, -966.816589, -19.859131, 164.761597, 76.350159, 484.062256, -418.952637, -712.246582, 102.882202, 65.237976, -75.846375, 1455.896606, 128.788574, -2186.134277, -175.934326, 533.289307, -417.827698, -1837.183228, 1259.949219, -1707.127808, -1557.582764, 543.913696, -1024.120117, -999.620300, -688.802368, -1402.526978, -984.533203, -577.601013, 1.597656, -448.548157, -2779.151367, -132.440796, 127.576355, -1159.496216, -591.234009, -761.699890, -868.097534, -553.323059, -598.193298, 1347.606934, -808.657288, -1132.797607, -1269.541016, -176.116272, -870.298096, -129.552124, -414.059875, -329.885681, -438.559937, -186.894531, -193.513184, -369.270691, -156.892151, 721.116394, -1016.575867, -337.550232, 409.850281, -360.587341, -712.011780, 408.418884, 286.642395, 900.344727, 1073.104248, 386.026062, 590.411804, 286.409180, 1685.595947, 929.072754, -240.138123, -1264.521606, 261.584839, 2514.025879, 1019.530457, -1789.124268, -705.084961, 895.520386, 1180.100098, 771.645020, 768.838623, 34.703796, 1001.947510, 2293.021973, -65.707275, -677.086792, 885.464844, 933.176392, 906.770020, 415.982178, -350.376587, 529.009644, 888.999207, -13.577942, -988.032349, 963.293884, 1456.130615, -959.203735, 584.057251, 1314.450073, -341.442871, -459.267578, 966.422241, -636.717346, -1193.484375, -126.362244, -1169.683716, -1757.143799, -1406.462646, -1309.041260, -1618.589111, -957.509888, -2497.054199, -2753.322510, -1359.652344, 431.389160, -1609.683960, -1824.436279, -869.819092, -1070.816162, -1987.131836, -2131.802246, -859.036865, -1373.548340, -1404.140381, -995.434692, -1320.533081, -1741.448608, -1381.586426, -1475.017822, -1435.972412, -1131.999023, -2033.722412, -722.850098, 1187.500488, -652.579529, -1970.623535, 115.820923, -111.190186, 214.521973, 1320.788940, -58.478027, -1616.345215, 1235.146973, 2039.784424, -169.334595, 918.201843, 665.967773, -1015.785889, 409.208618, 2186.908691, 1123.539307, 3049.583008, 1353.110107, -197.554810, 1795.498047, 1533.340698, 1401.702637, 2039.110840, 829.991699, 493.812744, 1456.693359, 2315.444824, 1748.297852, -249.239563, 1092.689087, 1456.991455, 536.435303, -378.882202, -22.326416, 1053.807007, 2721.808350, 901.452271, -50.761536, 598.957092, 1674.548950, 1764.037720, -159.007812, -977.642578, 443.806702, 474.254395, -725.266113, 577.144592, 1115.542358, 462.592102, 456.372986, -153.538025, 506.757263, 334.766113, 123.198486, 1457.279053, 1166.286865, -269.653931, 293.968445, 321.981079, 419.209534, 549.929504, -89.818542, 437.052917, -794.562378, -1276.182739, 950.378357, 983.072937, -844.723450, -842.781616, -1770.804199, 156.931213, -101.804016, -756.897400, -1620.416382, -232.659912, -1556.828979, -2102.706299, -1784.754883, -806.287598, -1640.184204, -3835.498047, -2659.606934, -1129.250977, -2705.554688, -2239.806152, -1199.947388, -1614.124146, -1563.428833, -1702.872192, -1148.203247, -1312.662109, -1555.006226, -446.710693, -486.854919, -1580.730835, -1355.167236, -957.927368, 136.016724, -579.031372, -1087.944214, -224.205688, 565.523193, -1262.649658, -2052.390381, 523.737854, 1030.084717, 66.174316, -272.892639, 8.763855, 816.628418, 1244.208252, 1211.371826, -612.137512, 1241.376465, 1913.545532, 1630.555298, 1150.542603, 1190.952515, 760.888306, 1647.792725, 1328.923828, 960.086670, 1463.835693, 1167.389160, 1470.070923, 1366.318604, 2252.218750, 389.688477, 1299.269531, 1943.525146, 990.260193, 630.323303, 1909.403809, 1293.090576, -292.599243, 531.237366, 949.208313, 1097.044800, 417.996582, -203.666016, 858.396057, 322.582092, 67.330750, 1383.703125, 401.493530, 818.688782, 883.146973, 73.712402, 431.878784, 871.838562, 25.402832, -95.209656, 149.407349, -605.008545, -775.315552, -410.429260, 501.004089, 173.136292, -1592.018799, -1055.747070, -744.408569, -187.063904, -100.024353, -449.207642, -1116.737793, -1063.553955, -1231.970459, -331.513916, -154.779541, -1705.894531, -1008.900635, 590.405701, -690.789551, -549.759827, -705.132874, -500.912537, -529.106323, -783.699890, 531.042114, -935.999084, -1495.713745, -260.146362, -276.544861, -1279.262207, -761.407288, -1115.715332, -533.574463, -268.354858, -346.641541, -537.307861, -824.888794, -1156.900879, 251.170471, 447.805542, -148.976257, -599.884766, -219.915955, 75.841309, -79.162537, 11.335876, 453.454590, 297.919495, -215.422180, 755.463013, 542.416626, 175.131958, 201.340942, -5.619873, 227.851501, 274.976746, 201.340698, -85.167542, 309.663208, 267.369446, 92.936951, -101.634033, 363.419495, 650.875000, 282.289734, 192.136597, 410.245850, 402.227051, 12.561462, 530.908997, 100.587769, 218.235229, 33.665466, 357.961487, 245.445923, 297.596375, 179.449036, 4.683105, 129.452881, 84.064392, -144.716858, -82.119629, -31.273315, 234.514404, 289.673462, 572.731445, 769.129822, 517.423279, 63.701233, -132.717346, 152.181580, 479.325623, 484.382629, 244.357544, -915.637146, 97.514832, 892.760254, 426.060852, 1710.518311, 1766.707275, 663.776123, 204.360840, 1536.431396, 1803.941162, 1529.902222, 1621.049805, 809.298889, 2334.142090, 2415.458740, 1208.960327, 1490.301758, 1728.914062, 1045.370361, 1712.035400, 1107.829834, 534.980103, 1779.620605, -156.023010, 1135.724609, 1060.392090, 813.045593, 1236.329224, -967.905273, -335.581909, -1349.867676, 128.885376, 155.249329, -1085.518799, -1957.525879, -1345.830811, -925.325073, -619.752441, 737.171997, -1692.055664, -567.870728, -1732.191284, 94.665039, 1588.237549, -4299.490234, -1562.899780, -867.713806, -1040.332764, -1546.585327, -1108.324219, -299.120117, -1854.418823, -3816.453857, -1358.572144, -1082.654907, -1061.410156, -576.116821, -2124.458740, -1109.680298, 433.354309, -2034.323242, -3257.466309, 1049.613281, 714.589417, -771.836182, -339.231445, -84.675964, -256.588318, -3876.753418, -1255.803833, 1944.319336, 2608.053467, -326.054749, 79.477844, -447.395325, 733.134888, 159.553528, 777.433716, -140.171997, 491.887024, 1186.868164, 1300.276367, -123.007446, 587.073730, 840.942322, 427.230225, 986.663696, 59.243591, 1970.481445, 349.632263, 524.630859, 1062.864746, 537.662476, 2754.460938, 2676.356445, -15.918213, 695.510071, 1647.092041, 820.840393, 3151.899414, -52.171265, -289.104492, 2364.737061, 1751.473145, -524.451843, 231.026855, 284.154419, -1199.160645, 360.579224, 1893.554321, 131.415588, -2099.354980, 326.446533, 672.875183, -629.714417, 1656.585449, -431.552795, -860.329651, -768.127747, -1622.354858, -904.841125, 2139.910156, -1489.334473, -2912.225830, -3222.216309, -2204.409180, 24.840881, -1431.772705, -3220.719971, -3427.651123, -2847.809082, 1482.622559, -759.288635, -3062.845215, -1477.844482, 138.599304, -1763.837158, -1172.232422, -1029.491211, -874.664307, -592.161804, -2519.300293, 1864.222168, -1055.266235, -1287.593384, 409.300293, 303.680603, -360.766296, -576.490723, -501.150574, 2369.523682, 453.816956, -1827.443359, 1033.822632, 650.584961, -42.631592, -112.535156, -528.031189, 781.440735, 2569.161377, 2294.668457, 57.058777, -695.331177, 1842.597778, 2965.961914, 402.995483, 152.316833, 1391.924316, 270.422974, 1914.352783, 1270.530518, 1859.860596, 2015.639648, 122.799805, 651.470642, 491.804871, -29.346191, 1271.834717, 449.550293, -213.841858, 1028.838379, 3139.684082, 1797.361084, -321.890076, 463.558167, 2158.349609, 2466.553223, 912.229553, 289.376343, 1468.756836, -521.572754, -19.338196, 761.271606, 2788.124023, 557.178223, -568.852783, 380.890137, -1115.224487, 1005.473755, 1190.385986, -568.352173, -438.035583, 238.040344, -627.440430, 704.998047, 2061.346924, -1.268372, -2162.174805, 431.566956, 509.960999, -782.627197, -1242.342896, 803.757935, -1871.546143, -1496.570801, 248.614746, -1348.729248, -1312.051636, 81.744812, -1204.058350, -1223.694092, -1076.602783, -1005.022034, -278.655334, -1875.221924, -1717.707764, -206.957397, -511.872681, -481.063782, -1515.418213, -859.391235, -404.564819, -630.728760, 970.427368, 17.874939, -1328.055908, -186.555542, -75.855530, -2132.986816, -2.461609, 515.547913, -923.979309, -690.255371, -192.196594, -305.505127, 179.109497, -1074.003418, 758.240784, -110.813843, -787.238220, 915.106445, -336.552795, -706.977234, 643.630493, 536.363464, 1513.397949, 1156.901367, -80.539062, 901.708923, 1040.455566, 1142.480225, 1167.759521, -249.059143, -395.734680, 926.888123, 1736.222412, 1533.261719, -814.251709, -811.315125, 726.661987, 1433.123291, 1057.693726, 1388.805664, -208.246582, 1110.083496, 2449.198975, -205.996826, -442.323425, 551.802795, 931.296021, 1456.145508, -128.253174, -205.203491, 794.181946, 720.414490, 279.795593, -805.039124, 769.431396, 1612.590088, -348.554138, 499.662231, 1494.587402, -1460.418579, 0.564270, 375.638245, -731.957214, -1352.518311, -402.507019, -206.794434, -1660.625000, -1864.163818, -766.217102, -1716.712524, -975.324341, -1928.412598, -2075.236084, -1238.511719, -31.571350, -1172.466797, -1510.857300, -1145.483887, -1423.009521, -1442.170898, -1973.239136, -613.677307, -1381.986694, -1105.843262, -407.410522, -1913.354004, -2875.824219, -820.328613, -1344.761230, -1450.303345, -1090.093018, -2414.988525, -565.860962, 763.856628, 216.142151, -1670.972656, -1173.154541, 291.918518, -107.824402, 1104.123413, 219.973206, -1068.302368, 537.056458, 2612.514404, 156.538330, 133.031677, 642.104248, 157.125977, 561.936035, 1426.301270, 2156.559326, 2593.402344, 1661.206299, 1246.395752, 1333.579102, 1589.358643, 1597.987183, 2309.745605, 1379.076172, 329.178406, 1686.973999, 1906.242920, 2524.306885, 244.038452, 1048.753540, 1731.199463, 997.470398, 429.143066, 508.560669, 708.980347, 2422.349121, 1509.868164, 948.637695, 248.048462, 871.097595, 1792.437256, 909.377625, -941.911377, 384.926331, 1162.531494, -813.559937, 863.405762, 1231.862549, -84.384155, 746.894836, -590.294922, 810.058899, 367.347778, -310.255493, 1144.783325, 548.228455, -180.037170, 112.810547, 99.226501, 410.193787, 190.305420, -321.974487, 632.637512, -936.956726, -1962.974365, 950.602661, 1147.101074, -1029.390869, -1319.161621, -1093.583496, 205.889160, -55.685669, -1757.475098, -1867.964600, -1173.871094, -1144.998535, -1019.217957, -2148.659668, -1247.926514, -1814.779419, -3277.987549, -2287.857666, -1025.639893, -1921.221313, -2398.063232, -1955.560059, -317.906433, -661.881226, -1448.784668, -1176.040039, -1305.073730, -590.304993, -748.228760, -554.461792, -1336.959839, -1667.391602, -279.324951, 412.995178, -703.742249, -1376.319946, 697.681763, -493.498047, -1566.942871, -235.718323, 990.832275, 625.268677, -601.064941, 641.495483, 1013.622437, 1111.786621, 2426.675049, 0.648590, -1.342834, -1.046585, -2.092010, -2.438171, -0.996506, -0.050308, 0.954819, -2.117065, -3.376297, -2.727951, -4.273621, -3.176041, -1.775131, -1.743759, -3.572250, -5.432770, -2.928848, -3.145325, -1.474655, -0.423691, -0.823502, 0.454285, 1.216446, 1.617905, 0.931351, 0.485153, -2.258560, 0.359741, 1.866501, 1.754074, 1.566147, 0.367355, 1.562073, 2.043945, 3.971878, 2.210129, 0.850861, 1.571732, 1.367462, 1.388275, 2.708344, 3.756332, 3.815491, 2.518265, 1.666779, 2.088303, 1.453934, 1.159775, 0.935242, 2.501846, 3.176910, 3.919342, 3.606216, 3.232986, 3.415878, 2.095398, 0.477478, 0.269043, 0.602341, 0.489990, 1.345398, 1.807297, 6.082520, 5.229782, 1.754852, 1.413406, -0.078522, 0.524170, 0.632172, 1.095520, -0.320206, -2.034332, 0.645859, 1.074097, 2.947128, 5.444336, 3.699631, 2.275177, 0.767105, 5.435593, 5.098648, 4.824020, 5.598206, 0.399216, 2.097992, 4.182938, 5.657730, 3.093903, 2.944214, 2.040619, 2.786316, 6.707230, 4.451172, 3.718552, 3.162476, 3.719162, 3.719223, 3.867767, -0.290375, 0.955612, 2.876633, 0.659210, 1.555405, -1.853836, -2.449448, -1.213821, 2.335083, 2.155045, 0.187943, 0.526459, -0.117737, 0.748291, -0.477158, -1.542130, -1.406570, -0.572327, -0.740402, -0.149521, 1.159424, 0.595627, 0.720337, 0.070007, 0.391174, 1.615723, 0.904755, 1.130127, -3.996399, -2.356506, 5.031662, 4.696457, 5.978394, 4.557343, 3.603958, 1.461838, 0.156616, 0.516190, -1.655533, -1.096542, -1.177048, -1.442032, -1.190048, -0.327621, 0.443390, 1.728561, -0.662170, 0.459106, -2.670425, -6.208725, -1.723068, 0.019882, 1.585648, -2.257202, -0.244339, -1.766525, 1.023026, 7.062073, 0.753052, -0.200058, -1.820450, -0.822617, 0.326553, 2.137604, 4.676193, 2.082535, 0.216858, 1.522736, 0.906296, 1.658218, 4.439621, 6.907120, 8.559021, 1.879990, 3.325134, 3.417694, 2.803040, 6.680389, 5.819290, 5.128677, 4.848572, 5.938095, 4.829773, 5.436768, 1.625229, 0.891006, 2.244080, 1.887543, 1.704178, -0.396393, -0.201706, -0.006317, 3.350693, 4.826324, 3.004898, 1.495209, 2.097610, -1.125931, -3.111145, -5.187851, 2.058456, 10.663803, 3.264359, 3.377609, 1.687759, 0.043716, 2.060089, 0.960480, -0.160385, 1.902252, 2.930313, 3.721634, 7.551682, 0.619507, -1.426300, -0.455215, 1.962021, 3.833328, 1.005081, 2.411316, -3.046112, -1.317932, 5.418961, 6.519821, 7.843170, 6.307526, 5.105759, 2.114075, 0.746948, 5.631409, 5.989990, 4.794083, 5.173599, 2.229065, 3.018997, 3.299286, 5.807816, 5.460419, 1.617569, 3.450500, 0.936966, 3.624527, 6.873566, 7.172379, 3.201355, 2.947144, 6.626343, 5.994736, 12.085587, 2.781265, -4.488129, -1.514557, 2.790726, 6.548935, 4.802246, 5.366699, -0.115631, 4.494965, 7.974426, 5.850052, 5.469254, 1.981842, 0.600800, 0.331802, 1.752045, 0.609802, 1.355133, 0.457047, 1.145096, 3.639893, 2.876724, 1.466553, -1.401535, -0.513931, 0.609543, 0.889511, 2.230942, 0.215256, -1.981400, -1.837143, -1.167175, -0.229004, 0.092896, 0.399841, -0.162796, 1.651703, 3.175110, 3.344177, 3.700851, 1.702438, 0.759216, 0.051865, 1.714249, 4.649414, 3.809937, 2.298920, 1.146622, -0.479202, 0.126083, 1.854141, 4.487991, 4.291183, 1.817947, 1.122009, -0.330673, 0.406265, 0.783432, -0.039734, -0.789459, 0.329559, 3.172089, 4.989426, 5.516235, 3.007156, 1.248169, 1.198792, 1.034531, -0.141998, -1.585815, -1.567490, 0.693619, 2.951187, 3.520676, 2.915024, 1.691345, 1.093430, -0.360794, -1.534180, -2.220917, -2.216537, -1.345230, -0.999527, 0.493317, 3.309708, 3.944000, 0.236694, -5.382477, -6.813843, -1.616302, 5.557739, 9.516846, 7.844467, 3.542542, 1.683273, 2.616455, 3.763947, 3.061676, 1.321793, -0.090469, -1.037109, -0.934174, 0.422180, 2.315933, 2.906769, 1.169525, -0.817413, -1.102524, -0.581161, -1.555710, -4.364029, -6.056580, -4.155350, 0.765076, 4.923676, 5.548660, 3.200241, 0.106018, -1.757446, -2.402573, -0.501663, 2.998734, 5.364487, 4.741806, 1.977753, 0.196014, -0.141220, 0.133453, -0.966156, -1.062683, 1.750305, 5.512650, 6.367188, 3.496277, 1.537094, 2.661377, 5.237411, 3.005508, -3.897079, -8.500336, -5.560654, 2.498550, 7.490219, 5.825714, 0.902634, -1.521271, -0.466309, 1.824615, 3.106140, 3.122726, 2.811890, 2.077911, 1.608170, 1.666077, 1.999908, 1.135880, -1.926147, -3.692795, -1.057556, 3.766953, 5.546143, 2.727554, -0.657928, -1.323303, -0.022400, -1.212555, -4.094757, -2.978653, 3.621490, 10.878143, 12.100739, 7.558304, 2.843567, 1.046127, -0.696014, -5.273514, -9.951111, -9.371567, -3.576096, 0.871017, -0.306076, -3.818588, -2.979431, 2.968613, 8.494171, 8.406464, 3.668777, -0.624222, -1.731262, -0.956543, -0.425217, -0.251205, -0.710129, -1.908539, -3.989960, -5.997238, -5.661072, -2.846664, 0.804230, 2.630493, 1.333969, -0.723770, -0.097321, 4.206253, 10.228302, 12.867599, 7.858826, -3.810516, -15.110397, -18.752136, -13.975067, -5.145752, 0.688385, 0.211746, -3.493805, -5.211166, -2.279083, 2.921936, 6.511215, 6.380920, 5.066498, 5.596405, 7.169434, 6.564331, 2.109543, -3.346146, -5.805557, -4.954025, -3.640076, -2.998276, -1.501099, 2.029236, 5.069916, 5.001419, 3.000870, 2.584122, 4.206558, 2.707901, -3.459518, -8.565186, -5.125793, 5.798279, 13.603912, 11.281113, 1.655212, -7.082367, -11.081863, -12.636917, -12.879303, -10.169952, -3.918381, 0.957718, 0.318726, -1.797394, 0.192856, 6.511139, 11.382248, 10.501465, 6.674637, 4.339294, 2.300873, -1.816299, -5.474625, -4.250015];
         let expected = vec![314.421906f32, 92.130051, 2140.864258, -490.657135, -1086.246948, 78.740814, 650.054016, 637.246521, -120.391449, -266.942017, -1448.166016, 1214.424316, -628.982361, 1917.769531, 2122.878906, 769.857422, -1754.991943, -72.151062, 1181.169922, 1206.524414, 680.867798, 419.850037, 2743.426270, 179.483978, -111.852753, 781.998169, 835.379272, 911.961914, 566.498901, 327.863586, 783.965881, 746.097412, -50.963135, 97.414619, 499.445465, 881.609436, 742.295837, -1212.245483, 174.936127, -62.887848, 1511.657104, -721.895630, -1115.149536, -786.506165, -1431.379395, -661.118530, 51.951752, 912.704956, -2217.920898, -1496.341064, -484.749084, 1282.288086, -742.341309, -3217.255859, -508.785675, 153.990692, -2049.337158, -443.762543, -105.091858, -625.062683, -963.668640, -3275.492188, 98.944641, -530.395264, -1364.267944, -673.831665, -1162.012207, -644.198547, -237.478882, -1092.183838, -2118.945801, 1356.443115, 125.147293, -614.699158, -981.487915, -55.637634, 1057.653442, -3268.674072, -1851.996582, 1347.791748, 1927.916748, -532.136108, 759.673401, -440.234589, 270.409363, 287.548370, -252.752228, 636.323120, 529.265808, 431.804382, 664.614807, 533.925171, 366.744812, 220.279282, -502.629700, 160.651337, 624.858215, 530.274170, 100.853348, 1660.336182, 659.029053, -17.549881, 2044.989624, 2112.067139, 12.841156, 423.069305, 1119.482178, 1276.874512, 2514.010742, -1125.771240, 558.787720, 1430.645020, 1058.884644, -396.688599, 474.153442, -884.276245, -875.415344, 675.950623, 245.101120, 28.433636, -475.421417, -505.849731, -300.303467, -298.689453, 1455.989014, -92.110176, -1295.407349, -459.733704, -1515.620483, -1033.271240, 1962.446045, -930.293701, -1808.559082, -3002.778076, -2415.438232, 789.545410, 26.710999, -3663.572998, -1833.961548, -2738.918701, 1362.428711, -826.227417, -1791.926758, -1692.106445, -291.994019, -1789.110962, -969.836548, -467.153320, -618.078125, -1358.420166, -2265.678467, 901.230591, -812.438354, -1280.078857, -830.702393, -884.873047, -575.173828, -155.413681, -1013.638428, 747.566223, -157.478607, -480.530151, -94.677109, -498.038452, 323.947449, -58.469528, -1727.740234, 671.243042, 1972.880005, 1780.975830, -79.360382, 37.118652, 992.247620, 986.017395, 730.011047, 646.933044, 656.792419, 810.643250, 940.322021, 879.327637, 957.611938, 642.986328, 363.083618, 224.431488, 560.780823, 875.712158, 635.596375, 436.262665, 927.629883, 738.430786, 2341.678223, 1265.043335, 710.935974, 227.947937, 1530.124756, 2773.256104, 1041.931763, 557.395508, 1556.667480, -1481.345215, -411.774475, 1877.948608, 2146.795898, -113.007393, -942.823547, 3.455299, 185.572998, 92.571274, 493.687653, -417.451813, -720.110840, 84.564758, 35.471889, -118.094330, 1400.588745, 60.659721, -2266.189453, -266.668335, 433.272278, -525.745178, -1951.605713, 1140.553589, -1829.913086, -1682.432739, 418.128418, -1149.793213, -1124.252319, -811.557251, -1522.624512, -1101.534790, -691.666321, -110.045738, -558.259460, -2887.247314, -239.139557, 22.277306, -1262.947388, -691.910034, -858.041443, -958.099670, -634.927002, -669.391541, 1288.838379, -853.120911, -1161.474609, -1281.628784, -171.632751, -850.090027, -94.850311, -366.090027, -269.764526, -367.122803, -104.721649, -101.061165, -266.872559, -44.855522, 842.371460, -886.961304, -201.208435, 550.715088, -217.417282, -568.509705, 550.406677, 425.302368, 1034.166260, 1201.306274, 508.598267, 707.737915, 398.988342, 1794.090088, 1034.372437, -137.193161, -1163.551270, 360.367767, 2610.134277, 1112.529175, -1699.607910, -619.331482, 977.372498, 1257.875244, 845.045654, 837.528503, 98.351318, 1060.374268, 2346.174316, -18.075611, -635.384033, 921.038574, 962.797607, 930.783936, 434.661072, -336.757904, 538.088074, 894.485779, -10.358431, -985.611084, 966.615845, 1462.536499, -947.140869, 604.303894, 1345.193359, -297.862854, -400.487274, 1042.443726, -542.163513, -1080.191162, 4.719925, -1022.926331, -1597.862671, -1238.540527, -1136.660767, -1445.916992, -788.646423, -2335.736084, -2602.624512, -1222.008545, 554.265076, -1502.437988, -1732.991821, -793.814453, -1009.305420, -1938.552490, -2094.187256, -830.362061, -1351.943237, -1388.004028, -983.560364, -1312.131470, -1736.113770, -1379.338379, -1476.245605, -1441.358154, -1142.414185, -2050.156738, -746.349731, 1155.994385, -692.822571, -2019.984009, 57.473969, -177.959808, 140.192276, 1239.851562, -145.277512, -1708.402588, 1138.401123, 1938.838745, -274.038879, 810.112244, 555.008911, -1128.662231, 295.701233, 2074.079346, 1012.601562, 2941.736816, 1249.639282, -295.454224, 1704.024292, 1448.764893, 1324.391235, 1969.488647, 768.332886, 440.109985, 1410.806274, 2277.227051, 1717.579346, -272.736450, 1076.011597, 1446.761475, 532.256836, -377.604309, -16.233227, 1064.203125, 2736.139893, 919.448608, -29.404085, 623.316223, 1701.581665, 1793.449951, -127.631470, -945.037659, 476.690094, 506.466614, -694.675781, 605.138184, 1140.072021, 483.097656, 472.710236, -141.162720, 515.567017, 340.523132, 126.590202, 1459.105957, 1167.196289, -269.277435, 294.068085, 321.991669, 419.209534, 549.929504, -89.818542, 437.052917, -794.562378, -1276.182739, 950.378357, 983.072937, -844.723450, -842.781616, -1770.804199, 156.931213, -101.804016, -756.897400, -1620.416382, -232.659912, -1556.828979, -2102.706299, -1784.754883, -806.287598, -1640.184204, -3835.498047, -2659.606934, -1129.250977, -2705.554688, -2239.806152, -1199.947388, -1614.124146, -1563.428833, -1702.872192, -1148.203247, -1312.662109, -1555.006226, -446.710693, -486.854919, -1580.730835, -1355.167236, -957.927368, 136.016724, -579.031372, -1087.944214, -224.205688, 565.523193, -1262.649658, -2052.390381, 523.737854, 1030.084717, 66.174316, -272.892639, 8.763855, 816.628418, 1244.208252, 1211.371826, -612.137512, 1241.376465, 1913.545532, 1630.555298, 1150.542603, 1190.952515, 760.888306, 1647.792725, 1328.923828, 960.086670, 1463.835693, 1167.389160, 1470.070923, 1366.318604, 2252.218750, 389.688477, 1299.269531, 1943.525146, 990.260193, 630.323303, 1909.403809, 1293.090576, -292.599243, 531.237366, 949.208313, 1097.044800, 417.996582, -203.666016, 858.396057, 322.582092, 67.330750, 1383.703125, 401.493530, 818.688782, 883.146973, 73.712402, 431.878784, 871.838562, 25.402832, -95.209656, 149.407349, -605.008545, -775.315552, -410.429260, 501.004089, 173.136292, -1592.018799, -1055.747070, -744.408569, -187.063904, -100.024353, -449.207642, -1116.737793, -1063.553955, -1231.970459, -331.513916, -154.779541, -1705.894531, -1008.900635, 590.405701, -690.789551, -549.759827, -705.132874, -500.912537, -529.106323, -783.699890, 531.042114, -935.999084, -1495.713745, -260.146362, -276.544861, -1279.262207, -761.407288, -1115.715332, -533.574463, -268.354858, -346.641541, -537.307861, -824.888794, -1156.900879, 251.170471, 447.805542, -148.976257, -599.884766, -219.915955, 75.841309, -79.162537, 11.335876, 453.454590, 297.919495, -215.422180, 755.463013, 542.416626, 175.131958, 201.340942, -5.619873, 227.851501, 274.976746, 201.340698, -85.167542, 309.663208, 267.369446, 92.936951, -101.634033, 363.419495, 650.875000, 282.289734, 192.136597, 410.245850, 402.227051, 12.561462, 530.908997, 100.587769, 218.235229, 33.665466, 357.961487, 245.445923, 297.596375, 179.449036, 4.683105, 129.452881, 84.064392, -144.716858, -82.119629, -31.273315, 234.514404, 289.673462, 572.731445, 769.129822, 517.423279, 63.701233, -132.717346, 152.181580, 479.325623, 484.382629, 244.357544, -915.637146, 97.514832, 892.760254, 426.060852, 1710.518311, 1766.707275, 663.776123, 204.360840, 1536.431396, 1803.941162, 1529.902222, 1621.049805, 809.298889, 2334.142090, 2415.458740, 1208.960327, 1490.301758, 1728.914062, 1045.370361, 1712.035400, 1107.829834, 534.980103, 1779.620605, -156.023010, 1135.724609, 1060.392090, 813.045593, 1236.329224, -967.905273, -335.581909, -1349.867676, 128.885376, 155.249329, -1085.518799, -1957.525879, -1345.830811, -925.325073, -619.752441, 737.171997, -1692.055664, -567.870728, -1732.191284, 94.665039, 1588.237549, -4299.490234, -1562.899780, -867.713806, -1040.332764, -1546.585327, -1108.324219, -299.120117, -1854.418823, -3816.453857, -1358.572144, -1082.654907, -1061.410156, -576.116821, -2124.458740, -1109.680298, 433.354309, -2034.323242, -3257.466309, 1049.613281, 714.589417, -771.836182, -339.231445, -84.675964, -256.588318, -3876.753418, -1255.803833, 1944.319336, 2608.053467, -326.054749, 79.477844, -447.395325, 733.134888, 159.553528, 777.433716, -140.171997, 491.887024, 1186.868164, 1300.276367, -123.007446, 587.073730, 840.942322, 427.230225, 986.663696, 59.243591, 1970.481445, 349.632263, 524.630859, 1062.864746, 537.662476, 2754.460938, 2676.356445, -15.918213, 695.510071, 1647.092041, 820.840393, 3151.899414, -52.171265, -289.104492, 2364.737061, 1751.473145, -524.451843, 231.026855, 284.154419, -1199.160645, 360.579224, 1893.554321, 131.415588, -2099.354980, 326.446533, 672.875183, -629.714417, 1656.585449, -431.552795, -860.329651, -768.127747, -1622.354858, -904.841125, 2139.910156, -1489.334473, -2912.225830, -3222.216309, -2204.409180, 24.840881, -1431.772705, -3220.719971, -3427.651123, -2847.809082, 1482.622559, -759.288635, -3062.845215, -1477.844482, 138.599304, -1763.837158, -1172.232422, -1029.491211, -874.664307, -592.161804, -2519.300293, 1864.222168, -1055.266235, -1287.593384, 409.300293, 303.680603, -360.766296, -576.490723, -501.150574, 2369.523682, 453.816956, -1827.443359, 1033.822632, 650.584961, -42.631592, -112.535156, -528.031189, 781.440735, 2569.161377, 2294.668457, 57.058777, -695.331177, 1842.597778, 2965.961914, 402.995483, 152.316833, 1391.924316, 270.422974, 1914.352783, 1270.530518, 1859.860596, 2015.639648, 122.799805, 651.470642, 491.804871, -29.346191, 1271.834717, 449.550293, -213.841858, 1028.838379, 3139.684082, 1797.361084, -321.890076, 463.558167, 2158.349609, 2466.553223, 912.229553, 289.376343, 1468.756836, -521.572754, -19.338196, 761.271606, 2788.124023, 557.178223, -568.852783, 380.890137, -1115.224487, 1005.473755, 1190.385986, -568.352173, -438.035583, 238.040344, -627.440430, 704.998047, 2061.346924, -1.268372, -2162.174805, 431.566956, 509.960999, -782.627197, -1242.342896, 803.757935, -1871.546143, -1496.570801, 248.614746, -1348.729248, -1312.051636, 81.744812, -1204.058350, -1223.694092, -1076.602783, -1005.022034, -278.655334, -1875.221924, -1717.707764, -206.957397, -511.872681, -481.063782, -1515.418213, -859.391235, -404.564819, -630.728760, 970.427368, 17.874939, -1328.055908, -186.555542, -75.855530, -2132.986816, -2.461609, 515.547913, -923.979309, -690.255371, -192.196594, -305.505127, 179.109497, -1074.003418, 758.240784, -110.813843, -787.238220, 915.106445, -336.552795, -706.977234, 643.630493, 536.363464, 1513.397949, 1156.901367, -80.539062, 901.708923, 1040.455566, 1142.480225, 1167.759521, -249.059143, -395.734680, 926.888123, 1736.222412, 1533.261719, -814.251709, -811.315125, 726.661987, 1433.123291, 1057.693726, 1388.805664, -208.246582, 1110.083496, 2449.198975, -205.996826, -442.323425, 551.802795, 931.296021, 1456.145508, -128.253174, -205.203491, 794.181946, 720.414490, 279.795593, -805.039124, 769.431396, 1612.590088, -348.554138, 499.662231, 1494.587402, -1460.418579, 0.564270, 375.638245, -731.957214, -1352.518311, -402.507019, -206.794434, -1660.625000, -1864.163818, -766.217102, -1716.712524, -975.324341, -1928.412598, -2075.236084, -1238.511719, -31.571350, -1172.466797, -1510.857300, -1145.483887, -1423.009521, -1442.170898, -1973.239136, -613.677307, -1381.986694, -1105.843262, -407.410522, -1913.354004, -2875.824219, -820.328613, -1344.761230, -1450.303345, -1090.093018, -2414.988525, -565.860962, 763.856628, 216.142151, -1670.972656, -1173.154541, 291.918518, -107.824402, 1104.123413, 219.973206, -1068.302368, 537.056458, 2612.514404, 156.538330, 133.031677, 642.104248, 157.125977, 561.936035, 1426.301270, 2156.559326, 2593.402344, 1661.206299, 1246.395752, 1333.579102, 1589.358643, 1597.987183, 2309.745605, 1379.076172, 329.178406, 1686.973999, 1906.242920, 2524.306885, 244.038452, 1048.753540, 1731.199463, 997.470398, 429.143066, 508.560669, 708.980347, 2422.349121, 1509.868164, 948.637695, 248.048462, 871.097595, 1792.437256, 909.377625, -941.911377, 384.926331, 1162.531494, -813.559937, 863.405762, 1231.862549, -84.384155, 746.894836, -590.294922, 810.058899, 367.347778, -310.255493, 1144.783325, 548.228455, -180.037170, 112.810547, 99.226501, 410.193787, 190.305420, -321.974487, 632.637512, -936.956726, -1962.974365, 950.602661, 1147.101074, -1029.390869, -1319.161621, -1093.583496, 205.889160, -55.685669, -1757.475098, -1867.964600, -1173.871094, -1144.998535, -1019.217957, -2148.659668, -1247.926514, -1814.779419, -3277.987549, -2287.857666, -1025.639893, -1921.221313, -2398.063232, -1955.560059, -317.906433, -661.881226, -1448.784668, -1176.040039, -1305.073730, -590.304993, -748.228760, -554.461792, -1336.959839, -1667.391602, -279.324951, 412.995178, -703.742249, -1376.319946, 697.681763, -493.498047, -1566.942871, -235.718323, 990.832275, 625.268677, -601.064941, 641.495483, 1013.622437, 1111.786621, 2426.675049, 0.648590, -1.342834, -1.046585, -2.092010, -2.438171, -0.996506, -0.050308, 0.954819, -2.117065, -3.376297, -2.727951, -4.273621, -3.176041, -1.775131, -1.743759, -3.572250, -5.432770, -2.928848, -3.145325, -1.474655, -0.423691, -0.823502, 0.454285, 1.216446, 1.617905, 0.931351, 0.485153, -2.258560, 0.359741, 1.866501, 1.754074, 1.566147, 0.367355, 1.562073, 2.043945, 3.971878, 2.210129, 0.850861, 1.571732, 1.367462, 1.388275, 2.708344, 3.756332, 3.815491, 2.518265, 1.666779, 2.088303, 1.453934, 1.159775, 0.935242, 2.501846, 3.176910, 3.919342, 3.606216, 3.232986, 3.415878, 2.095398, 0.477478, 0.269043, 0.602341, 0.489990, 1.345398, 1.807297, 6.082520, 5.229782, 1.754852, 1.413406, -0.078522, 0.524170, 0.632172, 1.095520, -0.320206, -2.034332, 0.645859, 1.074097, 2.947128, 5.444336, 3.699631, 2.275177, 0.767105, 5.435593, 5.098648, 4.824020, 5.598206, 0.399216, 2.097992, 4.182938, 5.657730, 3.093903, 2.944214, 2.040619, 2.786316, 6.707230, 4.451172, 3.718552, 3.162476, 3.719162, 3.719223, 3.867767, -0.290375, 0.955612, 2.876633, 0.659210, 1.555405, -1.853836, -2.449448, -1.213821, 2.335083, 2.155045, 0.187943, 0.526459, -0.117737, 0.748291, -0.477158, -1.542130, -1.406570, -0.572327, -0.740402, -0.149521, 1.159424, 0.595627, 0.720337, 0.070007, 0.391174, 1.615723, 0.904755, 1.130127, -3.996399, -2.356506, 5.031662, 4.696457, 5.978394, 4.557343, 3.603958, 1.461838, 0.156616, 0.516190, -1.655533, -1.096542, -1.177048, -1.442032, -1.190048, -0.327621, 0.443390, 1.728561, -0.662170, 0.459106, -2.670425, -6.208725, -1.723068, 0.019882, 1.585648, -2.257202, -0.244339, -1.766525, 1.023026, 7.062073, 0.753052, -0.200058, -1.820450, -0.822617, 0.326553, 2.137604, 4.676193, 2.082535, 0.216858, 1.522736, 0.906296, 1.658218, 4.439621, 6.907120, 8.559021, 1.879990, 3.325134, 3.417694, 2.803040, 6.680389, 5.819290, 5.128677, 4.848572, 5.938095, 4.829773, 5.436768, 1.625229, 0.891006, 2.244080, 1.887543, 1.704178, -0.396393, -0.201706, -0.006317, 3.350693, 4.826324, 3.004898, 1.495209, 2.097610, -1.125931, -3.111145, -5.187851, 2.058456, 10.663803, 3.264359, 3.377609, 1.687759, 0.043716, 2.060089, 0.960480, -0.160385, 1.902252, 2.930313, 3.721634, 7.551682, 0.619507, -1.426300, -0.455215, 1.962021, 3.833328, 1.005081, 2.411316, -3.046112, -1.317932, 5.418961, 6.519821, 7.843170, 6.307526, 5.105759, 2.114075, 0.746948, 5.631409, 5.989990, 4.794083, 5.173599, 2.229065, 3.018997, 3.299286, 5.807816, 5.460419, 1.617569, 3.450500, 0.936966, 3.624527, 6.873566, 7.172379, 3.201355, 2.947144, 6.626343, 5.994736, 12.085587, 2.781265, -4.488129, -1.514557, 2.790726, 6.548935, 4.802246, 5.366699, -0.115631, 4.494965, 7.974426, 5.850052, 5.469254, 1.981842, 0.600800, 0.331802, 1.752045, 0.609802, 1.355133, 0.457047, 1.145096, 3.639893, 2.876724, 1.466553, -1.401535, -0.513931, 0.609543, 0.889511, 2.230942, 0.215256, -1.981400, -1.837143, -1.167175, -0.229004, 0.092896, 0.399841, -0.162796, 1.651703, 3.175110, 3.344177, 3.700851, 1.702438, 0.759216, 0.051865, 1.714249, 4.649414, 3.809937, 2.298920, 1.146622, -0.479202, 0.126083, 1.854141, 4.487991, 4.291183, 1.817947, 1.122009, -0.330673, 0.406265, 0.783432, -0.039734, -0.789459, 0.329559, 3.172089, 4.989426, 5.516235, 3.007156, 1.248169, 1.198792, 1.034531, -0.141998, -1.585815, -1.567490, 0.693619, 2.951187, 3.520676, 2.915024, 1.691345, 1.093430, -0.360794, -1.534180, -2.220917, -2.216537, -1.345230, -0.999527, 0.493317, 3.309708, 3.944000, 0.236694, -5.382477, -6.813843, -1.616302, 5.557739, 9.516846, 7.844467, 3.542542, 1.683273, 2.616455, 3.763947, 3.061676, 1.321793, -0.090469, -1.037109, -0.934174, 0.422180, 2.315933, 2.906769, 1.169525, -0.817413, -1.102524, -0.581161, -1.555710, -4.364029, -6.056580, -4.155350, 0.765076, 4.923676, 5.548660, 3.200241, 0.106018, -1.757446, -2.402573, -0.501663, 2.998734, 5.364487, 4.741806, 1.977753, 0.196014, -0.141220, 0.133453, -0.966156, -1.062683, 1.750305, 5.512650, 6.367188, 3.496277, 1.537094, 2.661377, 5.237411, 3.005508, -3.897079, -8.500336, -5.560654, 2.498550, 7.490219, 5.825714, 0.902634, -1.521271, -0.466309, 1.824615, 3.106140, 3.122726, 2.811890, 2.077911, 1.608170, 1.666077, 1.999908, 1.135880, -1.926147, -3.692795, -1.057556, 3.766953, 5.546143, 2.727554, -0.657928, -1.323303, -0.022400, -1.212555, -4.094757, -2.978653, 3.621490, 10.878143, 12.100739, 7.558304, 2.843567, 1.046127, -0.696014, -5.273514, -9.951111, -9.371567, -3.576096, 0.871017, -0.306076, -3.818588, -2.979431, 2.968613, 8.494171, 8.406464, 3.668777, -0.624222, -1.731262, -0.956543, -0.425217, -0.251205, -0.710129, -1.908539, -3.989960, -5.997238, -5.661072, -2.846664, 0.804230, 2.630493, 1.333969, -0.723770, -0.097321, 4.206253, 10.228302, 12.867599, 7.858826, -3.810516, -15.110397, -18.752136, -13.975067, -5.145752, 0.688385, 0.211746, -3.493805, -5.211166, -2.279083, 2.921936, 6.511215, 6.380920, 5.066498, 5.596405, 7.169434, 6.564331, 2.109543, -3.346146, -5.805557, -4.954025, -3.640076, -2.998276, -1.501099, 2.029236, 5.069916, 5.001419, 3.000870, 2.584122, 4.206558, 2.707901, -3.459518, -8.565186, -5.125793, 5.798279, 13.603912, 11.281113, 1.655212, -7.082367, -11.081863, -12.636917, -12.879303, -10.169952, -3.918381, 0.957718, 0.318726, -1.797394, 0.192856, 6.511139, 11.382248, 10.501465, 6.674637, 4.339294, 2.300873, -1.816299, -5.474625, -4.250015];

         let result = lpd_bpf_fix(&usac_data, true, &mut buffer, &lpd_st);

         assert!(result.is_ok());
         assert_eq!(buffer.len(), expected.len());
         for i in 0..buffer.len() {
            assert_relative_eq!(buffer[i], expected[i], epsilon = 1e-6);
         }
    }
}
